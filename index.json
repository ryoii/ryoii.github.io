[{"categories":["MySQL"],"content":" MySQL 有一个大家都知道的坑点，就是 utf8 字符集并不是标准规范里的 utf8。对此，MySQL 给出了 utf8mb4 字符集对应标准的 utf8。 但是如果旧数据库已经使用上错误的 utf8 字符集，现在要进行切换就比较麻烦了。而 MySQL 是没有提供这样 DDL 的，所以有了批量修改字符集的需求。 ","date":"2021-12-22","objectID":"/posts/mysql/mysql-charset-reset/:0:0","series":null,"tags":["MySQL"],"title":"MySQL 批量修改字符集","uri":"/posts/mysql/mysql-charset-reset/#"},{"categories":["MySQL"],"content":"大致思路 读取表结构，给指定数据库生成 DDL 语句再批量执行。 修复过程大致上分为三步 修复字段 修复表 修复数据库 ","date":"2021-12-22","objectID":"/posts/mysql/mysql-charset-reset/:1:0","series":null,"tags":["MySQL"],"title":"MySQL 批量修改字符集","uri":"/posts/mysql/mysql-charset-reset/#大致思路"},{"categories":["MySQL"],"content":"修复表字段 MySQL 表结构都保存在 information_schema 这个库中。其中 COLUMNS 这张表保存了所有的表字段。 SELECTTABLE_SCHEMA'数据库',TABLE_NAME'表名',COLUMN_NAME'列名',CHARACTER_SET_NAME'字符集',COLLATION_NAME'排序规则',CONCAT('ALTER TABLE ',TABLE_SCHEMA,'.',TABLE_NAME,' MODIFY COLUMN ',COLUMN_NAME,' ',COLUMN_TYPE,' COMMENT \"',COLUMN_COMMENT,'\" CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;')'修复语句'FROMinformation_schema.COLUMNSWHERETABLE_SCHEMA='\u003cdatabase\u003e'ANDTABLE_NAME='\u003ctable\u003e'ANDCOLLATION_NAMERLIKE'utf8'; 警告 这里的表备注一定不要去掉，不然表备注是会被清空的。 注意 \u003cdatabase\u003e 和 \u003ctable\u003e 填要修改的表和库名，限定修改范围。COLLATION_NAME 是原字符集，这里限定了只修改错误的 utf8 编码，如果修改全部字段编码，去掉这个过滤条件就好了。 最后把生成出来的修复语句拷贝出来，粘贴到你熟悉的工具批量执行，或者放到文本里作为 .sql 直接执行。 ","date":"2021-12-22","objectID":"/posts/mysql/mysql-charset-reset/:1:1","series":null,"tags":["MySQL"],"title":"MySQL 批量修改字符集","uri":"/posts/mysql/mysql-charset-reset/#修复表字段"},{"categories":["MySQL"],"content":"修复表 表的信息在 information_schema.TABLES 这张表 SELECTTABLE_SCHEMA'数据库',TABLE_NAME'表名',TABLE_COLLATION'原排序规则',CONCAT('ALTER TABLE ',TABLE_SCHEMA,'.',TABLE_NAME,'COLLATE=utf8mb4_general_ci;')'修复语句'FROMinformation_schema.TABLESWHERETABLE_COLLATIONRLIKE'utf8'; 同样把修复语句拷贝出来批量执行 ","date":"2021-12-22","objectID":"/posts/mysql/mysql-charset-reset/:1:2","series":null,"tags":["MySQL"],"title":"MySQL 批量修改字符集","uri":"/posts/mysql/mysql-charset-reset/#修复表"},{"categories":["MySQL"],"content":"修复数据库 数据库的信息在 information_schema.SCHEMATA 这张表 SELECTSCHEMA_NAME'数据库',DEFAULT_CHARACTER_SET_NAME'原字符集',DEFAULT_COLLATION_NAME'原排序规则',CONCAT('ALTER DATABASE ',SCHEMA_NAME,' CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;')'修复语句'FROMinformation_schema.SCHEMATAWHEREDEFAULT_CHARACTER_SET_NAMERLIKE'utf8'; ","date":"2021-12-22","objectID":"/posts/mysql/mysql-charset-reset/:1:3","series":null,"tags":["MySQL"],"title":"MySQL 批量修改字符集","uri":"/posts/mysql/mysql-charset-reset/#修复数据库"},{"categories":["Linux"],"content":" 最近在一个离线的电脑上要安装一个 fastdfs 做内网的文件服务器。fastdfs 又只提供了源码提供编译安装，于是要在一台我十分讨厌的 Centos 系统上做离线安装 gcc-c++, libevnet等一众依赖库支持编译。麻烦在于这些库的依赖也很多，一个个找依赖肯定是不可行的。就想着是不是可以通过 yum 导出所有的依赖。 ","date":"2021-12-21","objectID":"/posts/linux/centos-yum-offline-install/:0:0","series":null,"tags":["centos","yum","运维"],"title":"Centos 离线安装 yum 软件","uri":"/posts/linux/centos-yum-offline-install/#"},{"categories":["Linux"],"content":"yumdownloader yumdownloader 可以根据 yum 一样的依赖管理，把所需要的 rpm 包一并下载到本地，包括所有嵌套的依赖项。 那么只要找一台有网络的机器把所有依赖包下好，再在离线安装的机器上一键安装就好了。 ","date":"2021-12-21","objectID":"/posts/linux/centos-yum-offline-install/:1:0","series":null,"tags":["centos","yum","运维"],"title":"Centos 离线安装 yum 软件","uri":"/posts/linux/centos-yum-offline-install/#yumdownloader"},{"categories":["Linux"],"content":"安装 yumdownloader yum install -y yum-utils ","date":"2021-12-21","objectID":"/posts/linux/centos-yum-offline-install/:1:1","series":null,"tags":["centos","yum","运维"],"title":"Centos 离线安装 yum 软件","uri":"/posts/linux/centos-yum-offline-install/#安装-yumdownloader"},{"categories":["Linux"],"content":"下载所有依赖包 # 下载 gcc—c++,libevent 及其依赖 yumdownloader gcc-c++ libevent 注意 默认会将所有 rpm 包下载到当前目录，用 –destdir 参数指定下载目录 ","date":"2021-12-21","objectID":"/posts/linux/centos-yum-offline-install/:1:2","series":null,"tags":["centos","yum","运维"],"title":"Centos 离线安装 yum 软件","uri":"/posts/linux/centos-yum-offline-install/#下载所有依赖包"},{"categories":["Linux"],"content":"打包复制离线机器后安装 # 安装所有 rpm 包 rpm -Uvh *.rpm # 如果出现依赖缺失可以尝试关闭依赖分析 rpm -Uvh --nodeps *.rpm ","date":"2021-12-21","objectID":"/posts/linux/centos-yum-offline-install/:1:3","series":null,"tags":["centos","yum","运维"],"title":"Centos 离线安装 yum 软件","uri":"/posts/linux/centos-yum-offline-install/#打包复制离线机器后安装"}]